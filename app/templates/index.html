{% extends 'base.html' %}
{% set use_hero = true %}
{% import 'macros/_render_field.html' as wtf %}
{% block title %} Home {% endblock %}

{% block content %}
<section id="hero">
 <div class="jumbotron">
  <div class="container text-center">
   <div class="row">
    <div class="col-md-12">
     <img class="logo" src="{{url_for('static', filename='img/KSVotes_Logo_Primary_CMYK.png')}}" alt="hero ksvotes" />
     <div class="splash">
      <h1 class="h1-responsive">{{_('0_title')}}</h1>
      <p class="lead">{{_('0_lead')}}</p>
      <hr class="my-2">
      <p>{{_('0_intro')}}</p>
      <a href="#step_0" class="icon"><i class="fa fa-angle-down fa-lg"></i></a>
    </div>
   </div>
  </div>
 </div>
</section>


<section id="formsection">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-md-6">
        <form name="step_0" id="step_0" method="POST" action="{{url_for('main.index')}}">
         <fieldset>
          <legend>{{_('0_form_explain')}}</legend>

          {{form.hidden_tag()}}

          {{wtf.render_field(
            form.name_first,
            _('0_name_help'),
            {
              'required':'required',
              'data-parsley-error-message': _('Required'),
              'autocomplete':'off',
              'data-parsley-trigger':'focusout'
            }
            )}}

          {{wtf.render_field(
            form.name_last,
            _('0_name_help'),
            {
              'required':'required',
              'data-parsley-error-message': _('Required'),
              'autocomplete':'off',
              'data-parsley-trigger':'focusout'
            }
            )}}

            {{wtf.render_field(
              form.dob,
              _('0_dob_help'),
              {
                'required':'required',
                'data-parsley-required-message': _('Required'),
                'autocomplete':'off',
                'data-parsley-trigger':'focusout',
                'data-parsley-pattern-message': _('0_dob_flag'),
                'data-parsley-pattern': "/^\d{2}[\/-]?\d{2}[\/\-]?\d{4}$/",
                'data-parsley-dob-limit':"true",
                'data-parsley-dob-limit-message': _('0_dob_flag'),
                'placeholder':'mm/dd/yyyy',
              }
              )}}

            {{wtf.render_field(
              form.county,
              _('0_county_help'),
              {
                'required': 'required',
                'data-parsley-required-message': _('Required'),
                'data-parsley-trigger': 'focusout'
              }
              )}}

            {{wtf.render_field(
              form.email,
              _('0_email_help'),
              {
                'required': 'required',
                'data-parsley-required-message': _('Required'),
                'data-parsley-trigger': 'focusout',
                'data-parsley-type': 'email',
                'data-parsley-type-message': _('0_email_flag'),
              }
              )}}

            {{wtf.render_field(
              form.phone,
              _('0_phone_help'),
              {
                'data-parsley-trigger': 'focusout',
                'data-parsley-pattern': '/^\d{3}[\-\.]?\d{3}[\-\.]?\d{4}$/',
                'data-parsley-pattern-message': _('0_phone_flag'),
                'data-parsley-phone-limit':"true",
                'data-parsley-phone-limit-message': _('0_dob_flag'),
                'placeholder': 'xxx-xxx-xxxx',
              }
              )}}

            {% if form.recaptcha %}
            {{wtf.render_field(
              form.recaptcha
              )}}
            {% endif %}

          <div class="text-right mt-4">
              <button class="btn btn-outline-default" type="submit"><i class="fa fa-spinner fa-spin loading mr-2"></i><i class="fa checkmark fa-check mr-2"></i> Next </button>
          </div>
         </fieldset>
        </form>
      </div>
    </div>
  </div>
</section>
{% endblock %}

{% block js_footer %}
<script>
$(function () {
  //initialize form with parsley validation
  var form = $('#step_0');
  window.Parsley.addValidator('dobLimit', {
    requirementType: 'string',
    validateString: function(value) {
      var mdy = value.match(/^(\d{2})[\/-]?(\d{2})[\/\-]?(\d{4})$/);
      mdy.shift();
      var dob = mdy.join('/');
      //console.log(mdy, dob);
      var compare = Math.floor(moment(new Date()).diff(moment(dob,"MM/DD/YYYY"),'years',true));
      if (compare <= 15) {
        return false;
      }
      $('#dob').val(dob); // normalize input
      return true;
    }
  });
  window.Parsley.addValidator('phoneLimit', {
    requirementType: 'string',
    validateString: function(value) {
      var phone_parts = value.match(/^(\d{3})[\.\-]?(\d{3})[\.\-]?(\d{4})$/);
      phone_parts.shift();
      $('#phone').val(phone_parts.join('-')); // normalize
      return true; // no actual check, just normalize
    }
  });
  form.parsley()
});

</script>
{% endblock %}
