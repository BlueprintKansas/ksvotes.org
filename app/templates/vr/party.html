{% extends 'base.html' %}
{% set current_step = '4' %}
{% import 'macros/_render_field.html' as wtf %}

{% block title %} Party {% endblock %}

{% block content %}
<section id="formsection">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-md-6">
        {% if registrant.registration_value.validated_addresses %}
          {% for k,v in registrant.registration_value.validated_addresses.items() %}

            <h6>
            {% if k == 'current_address' %}
              {{_('3_addr')}}:
            {% elif k == 'prev_addr'%}
              {{_('3_prev_addr')}}:
            {% elif k == 'mail_addr'%}
              {{_('3_mail_addr')}}:
            {% endif %}
            {% if 'error' in registrant.registration_value.validated_addresses[k] %}
            <span class="address-error">
                  <i class="fa fa-times"></i>
                  <a href="{{url_for('main.vr3_address')}}">  _('3_invalid') </a>
            </span>
            {% else %}
             <span class="validated"><i class="fa fa-check"></i>
               {{registrant.registration_value.validated_addresses.get(k).get('address', '')}}
               {{registrant.registration_value.validated_addresses.get(k).get('unit', '')}}
               {{registrant.registration_value.validated_addresses.get(k).get('city', '')}}
               {{registrant.registration_value.validated_addresses.get(k).get('state', '')}}
               {{registrant.registration_value.validated_addresses.get(k).get('zip5','')}}
             </span>
            {% endif%}
            <h6>
          {% endfor %}
        {% endif %}
        <form name="step_4" id="step_4" method="POST" action="{{url_for('main.vr4_party')}}">
         <fieldset>
          <legend>{{_('4_legend')}}</legend>

          {{form.hidden_tag()}}

          {{wtf.render_field(
            form.party,
            _('4_party_help'),
            {
              'required':'required',
              'data-parsley-error-message': _('Required'),
            }
            )}}


          <div class="text-right mt-4">
              <button class="btn btn-outline-default" type="submit"><i class="fa fa-spinner fa-spin loading mr-2"></i><i class="fa checkmark fa-check mr-2"></i> Next </button>
          </div>
         </fieldset>
        </form>
      </div>
    </div>
  </div>
</section>
{% endblock %}

{% block js_footer %}
<script>
$(function () {
  //initialize form with parsley validation
  var form = $('#step_4');
  form.parsley()
});

</script>
{% endblock %}
