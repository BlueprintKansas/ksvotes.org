{% extends 'base.html' %}
{% import 'macros/_render_field.html' as wtf %}

{% block title %} Address {% endblock %}

{% block content %}
<section id="formsection">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-md-6">
        <form name="step_3" id="step_3" method="POST" action="{{url_for('main.vr3_address')}}">
          {{form.hidden_tag()}}

          {{wtf.render_field(
            form.addr,
            _('3_addr_help'),
            {
              'required':'required',
              'data-parsley-error-message': _('Required'),
              'autocomplete':'off',
              'data-parsley-trigger':'focusout'
            }
            )}}

            {{wtf.render_field(
              form.unit,
              _('3_unit'),
              None,
              )}}

            {{wtf.render_field(
              form.city,
              _('3_city'),
              {
                'required':'required',
                'data-parsley-error-message': _('Required'),
                'autocomplete':'off',
                'data-parsley-trigger':'focusout'
              }
              )}}

            {{wtf.render_field(
              form.state,
              _('3_state'),
              {
                'required':'required',
                'data-parsley-error-message': _('Required'),
                'autocomplete':'off',
                'data-parsley-trigger':'focusout'
              }
              )}}

            {{wtf.render_field(
              form.zip,
              _('3_zip_help'),
              {
                'required':'required',
                'data-parsley-error-message': _('Required'),
                'autocomplete':'off',
                'data-parsley-trigger':'focusout',
                'data-parsley-pattern-message': _('0_zip_help'),
                'data-parsley-pattern': "/^\d{5}$/",
              }
              )}}

              {{wtf.render_field(
                form.has_prev_addr,
                _('3_has_prev_addr'),
                )}}

          <div class="previous-address-fields">
            <h1 class="h1-responsive"> {{_('3a_header')}} </h1>
            {{wtf.render_field(
              form.prev_addr,
              _('3a_prev_addr'),
              {
                'data-parsley-error-message': _('Required'),
                'autocomplete':'off',
                'data-parsley-trigger':'focusout'
              }
              )}}

              {{wtf.render_field(
                form.prev_unit,
                _('3a_prev_unit'),
                None,
                )}}

              {{wtf.render_field(
                form.prev_city,
                _('3a_prev_city'),
                {
                  'data-parsley-error-message': _('Required'),
                  'autocomplete':'off',
                  'data-parsley-trigger':'focusout'
                }
                )}}

              {{wtf.render_field(
                form.prev_state,
                _('3a_prev_state'),
                {
                  'data-parsley-error-message': _('Required'),
                  'autocomplete':'off',
                  'data-parsley-trigger':'focusout'
                }
                )}}

              {{wtf.render_field(
                form.prev_zip,
                _('3_zip_help'),
                {
                  'data-parsley-error-message': _('Required'),
                  'autocomplete':'off',
                  'data-parsley-trigger':'focusout',
                  'data-parsley-pattern-message': _('0_zip_help'),
                  'data-parsley-pattern': "/^\d{5}$/",
                }
                )}}
          </div><!--/previous-address-fields-->

          {{wtf.render_field(
            form.has_mail_addr,
            _('3_has_mail_addr'),
            )}}

          <div class="mail-address-fields">

            <h1 class="h1-responsive"> {{_('3b_header')}} </h1>
            {{wtf.render_field(
              form.mail_addr,
              _('3b_mail_addr'),
              {
                'data-parsley-error-message': _('Required'),
                'autocomplete':'off',
                'data-parsley-trigger':'focusout'
              }
              )}}

              {{wtf.render_field(
                form.mail_unit,
                _('3b_mail_unit'),
                None,
                )}}

              {{wtf.render_field(
                form.mail_city,
                _('3b_mail_city'),
                {
                  'data-parsley-error-message': _('Required'),
                  'autocomplete':'off',
                  'data-parsley-trigger':'focusout'
                }
                )}}

              {{wtf.render_field(
                form.mail_state,
                _('3b_mail_state'),
                {
                  'data-parsley-error-message': _('Required'),
                  'autocomplete':'off',
                  'data-parsley-trigger':'focusout'
                }
                )}}

              {{wtf.render_field(
                form.mail_zip,
                _('3b_zip_help'),
                {
                  'data-parsley-error-message': _('Required'),
                  'autocomplete':'off',
                  'data-parsley-trigger':'focusout',
                  'data-parsley-pattern-message': _('0_zip_help'),
                  'data-parsley-pattern': "/^\d{5}$/",
                }
                )}}
          </div><!-- mail address fields -->






          <div class="text-right mt-4">
              <button class="btn btn-outline-default" type="submit"><i class="fa fa-spinner fa-spin loading mr-2"></i><i class="fa checkmark fa-check mr-2"></i> Next </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</section>
{% endblock %}

{% block js_footer %}
<script>
$(function () {
  //initialize form with parsley validation
  var form = $('#step_3');
  $('input[name=has_prev_addr]').change(
      function(){
          if (this.checked) {
              $('.previous-address-fields').show();
              $('#prev_zip').attr("required", true);
              $('#prev_state').attr("required", true);
              $('#prev_city').attr("required", true);
              $('#prev_addr').attr("required", true);

          } else {
              $('.previous-address-fields').hide();
              $('#prev_zip').removeAttr("required").val('').blur();
              $('#prev_state').removeAttr("required").val('').blur();
              $('#prev_city').removeAttr("required").val('').blur();
              $('#prev_addr').removeAttr("required").val('').blur();
          }
      });

  $('input[name=has_mail_addr]').change(
      function(){
          if (this.checked) {
              $('.mail-address-fields').show();
              $('#mail_zip').attr("required", true);
              $('#mail_state').attr("required", true);
              $('#mail_city').attr("required", true);
              $('#mail_addr').attr("required", true);

          } else {
              $('.mail-address-fields').hide();
              $('#mail_zip').removeAttr("required").val('').blur();
              $('#mail_state').removeAttr("required").val('').blur();
              $('#mail_city').removeAttr("required").val('').blur();
              $('#mail_addr').removeAttr("required").val('').blur();
          }
      });

  form.parsley()
});
</script>
{% endblock %}
